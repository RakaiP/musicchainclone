{"ast":null,"code":"var _jsxFileName = \"/home/fergussojr/Documents/UGM/BlockChain/Demo/finalproject/MusicChain/react/src/UploadPage.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { uploadAudioIPFS } from \"./ipfs/upload\";\nimport clsx from \"clsx\";\nimport { makeStyles, Container, Grid, Paper, Typography, TextField, Button, Snackbar, CircularProgress } from \"@material-ui/core\";\nimport Alert from \"@material-ui/lab/Alert\";\nimport LinearProgress from \"@material-ui/core/LinearProgress\";\nimport Box from \"@material-ui/core/Box\"; // import {} from '@material-ui/lab/Alert';\n\nimport CloudUploadIcon from \"@material-ui/icons/CloudUpload\";\nimport MatchingResultList from \"./components/MatchingResultList\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  container: {\n    paddingTop: theme.spacing(5),\n    paddingLeft: theme.spacing(5),\n    paddingRight: theme.spacing(5),\n    paddingBottom: theme.spacing(5),\n    backgroundColor: \"#202020\"\n  },\n  paper: {\n    padding: theme.spacing(2),\n    display: \"flex\",\n    overflow: \"auto\",\n    flexDirection: \"column\",\n    backgroundColor: \"#808080\"\n  },\n  fixedHeight: {\n    height: 240\n  },\n  // Upload Box style\n  uploadBoxFixedHeight: {// height: 420,\n  },\n  backendInfoDisplay: {\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4) // width: '36ch',\n\n  },\n  inputForm: {\n    \"& .MuiTextField-root\": {\n      margin: theme.spacing(2),\n      marginLeft: theme.spacing(4),\n      marginRight: theme.spacing(4),\n      width: \"36ch\"\n    }\n  },\n  uploadinput: {\n    display: \"none\"\n  },\n  selectbutton: {\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4)\n  },\n  fileinput: {\n    margin: theme.spacing(1),\n    marginLeft: theme.spacing(4),\n    width: \"56ch\"\n  },\n  uploadbutton: {\n    position: \"relative\",\n    backgroundColor: \"#39a9cb\",\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4),\n    height: \"5ch\"\n  }\n}));\n\nconst UploadPage = props => {\n  _s();\n\n  const classes = useStyles();\n  const UploadPaperHeight = clsx(classes.paper, classes.uploadBoxFixedHeight); // from props\n\n  const web3 = props.web3;\n  const accounts = props.accounts;\n  const contract = props.contract;\n  const setPage = props.setPage; // for alert msg\n\n  const callAlert = props.callAlert;\n  useEffect(() => {\n    setPage(\"Upload\");\n  }, []); // states\n\n  const [songname, setSongName] = useState(\"\");\n  const [songartist, setSongArtist] = useState(\"\");\n  const [songdata, setSongData] = useState({\n    selectedFile: null\n  });\n  const [songHash, setSongHash] = useState(\"\");\n  const [fileTextField, setFileTextField] = useState(\"you haven't select a file yet...\");\n  const [fingerprstatus, setFingerprstatus] = useState(\"no file yet\");\n  const [backendInfo, setBackendInfo] = useState([]);\n  const [matchingProgress, setMatchingProgress] = useState({}); // // for alert msg\n  // const [alertmsg, setAlermsg] = useState('');\n  // const [openAlert, setOpenAlert] = useState(false);\n  // const handleCloseAlertMsg = (event, reason) => {\n  //   if (reason === 'clickaway') {\n  //     return;\n  //   }\n  //   setOpenAlert(false);\n  // };\n  // const callAlert = (msg) => {\n  //   setAlermsg(msg);\n  //   setOpenAlert(true);\n  // };\n  // for HPCP matching progress UI\n\n  const [matchresults, setMatchResults] = useState([// {\n    //   \"name\": \"song1\",\n    //   \"artist\": \"artist1\",\n    //   \"ipfs_hash\": \"hash ipfs\",\n    //   \"uploader\": \"user1\",\n    //   \"dist\": \"cover_dist1\",\n    //   \"exact\" : false\n    // }\n  ]);\n  const [pendingMsg, setPendingMsg] = useState(\"\");\n  const [uploadPending, setUploadPending] = useState(false);\n\n  const showResult = async data => {\n    data.sort((x, y) => Number(x.dist) - Number(y.dist));\n    console.log(data);\n\n    for (let i = 0; i < data.length; i++) {\n      const result_from_chain = await getMusicByHash(data[i].song_hash);\n      data[i].name = result_from_chain.name;\n      data[i].artist = result_from_chain.artist;\n      data[i].coverFrom = result_from_chain.coverFrom;\n      data[i].name = result_from_chain.name;\n      data[i].ipfs_hash = data[i].song_hash;\n      data[i].uploader = result_from_chain.uploader;\n      data[i].uploadTime = result_from_chain.uploadTime;\n    }\n\n    console.log(data);\n    setMatchResults(data);\n  };\n\n  const getMusicByHash = async h => {\n    const result = await contract.methods.getMusicByHash(h).call({\n      from: accounts[0]\n    });\n    return result;\n  };\n\n  const getMusicExists = async () => {\n    const result = await contract.methods.musicExists(songname, songartist).call({\n      from: accounts[0]\n    });\n    return result;\n  };\n\n  const uploadMusicBlockchain = async (retHash, coverFromHash = \"None\") => {\n    try {\n      const music = await contract.methods.uploadMusic(retHash, songname, songartist, coverFromHash).send({\n        from: accounts[0]\n      });\n      console.log(music);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleUploads = async () => {\n    // console.log(`web3: ${web3}`);\n    // console.log(`accounts: ${accounts}`);\n    // console.log(`contract: ${contract}`);\n    // Force user to fill these input field\n    if (!songname) {\n      callAlert(\"You have to set the SONG name!\");\n      return;\n    }\n\n    if (!songartist) {\n      callAlert(\"You have to set the ARTIST name!\");\n      return;\n    }\n\n    if (!songdata.selectedFile) {\n      callAlert(\"You have to upload a file!\");\n      return;\n    }\n\n    if (songdata.selectedFile.size >= 100000000) {\n      callAlert(\"The file limit is 100 MB!\");\n      setSongData({\n        selectedFile: null\n      });\n      return;\n    }\n\n    let musicExists = await getMusicExists();\n\n    if (musicExists) {\n      callAlert(\"The music had already existed!\");\n      return;\n    }\n\n    setUploadPending(true);\n    uploadAudioIPFS(songdata.selectedFile, songname, retHash => {\n      setSongHash(retHash);\n      const source = new EventSource(`http://localhost:3001/processupload?h=${retHash}`, {\n        withCredentials: true\n      });\n      source.addEventListener(\"message\", message => {\n        // let mydata = JSON.stringify(JSON.parse(message.data))\n        console.log(\"Got\", message.data);\n        let msg_obj = JSON.parse(message.data); // setBackendInfo(backendInfo.concat([JSON.parse(JSON.stringify(msg_obj))]))\n        // setBackendInfo(backendInfo.push(msg_obj))\n        // setBackendInfo(backendInfo.concat(JSON.parse(JSON.stringify(msg_obj))));\n\n        setBackendInfo([...backendInfo, msg_obj]);\n\n        if (msg_obj.status === \"saved_query_hpcp\") {\n          source.close();\n          setUploadPending(false);\n\n          if (msg_obj.payload.length > 0) {\n            console.log(\"coverfrom\" + msg_obj.payload[0]);\n            uploadMusicBlockchain(retHash, msg_obj.payload[0]);\n          } else {\n            uploadMusicBlockchain(retHash);\n          }\n        } else if (msg_obj.status === \"matching_results\") {\n          // let x = { \"status\": \"matching_results\", \"payload\": [{ \"song_hash\": \"QmRhPHUnNHUodTJb5QciUj6zuEHZZd5fFVTBoJnUTwKh9N\", \"dist\": 0.22824497520923615, \"exact\": false }, { \"song_hash\": \"QmY3vX8TRHvM8RsgJCjHP4FVRNq1CgC6poTPUBxEHRRhkw\", \"dist\": 0.15082646906375885, \"exact\": false }] }\n          showResult(msg_obj.payload);\n        } else if (msg_obj.status === \"matching\") {\n          setMatchingProgress(msg_obj.payload);\n        } else if (msg_obj.status === \"music_exist\") {\n          source.close();\n          setUploadPending(false);\n          callAlert(\"This music is uploaded before\");\n        } else {// setFingerprstatus(message.data);\n        }\n\n        console.log(\"backendInfo\", backendInfo);\n      }); // uplaodMusicBlockchain(retHash);\n    }); // reset input data\n\n    setSongName(\"\");\n    setSongArtist(\"\");\n    setFileTextField(\"you haven't select a file yet...\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"lg\",\n    className: classes.container,\n    children: /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 6,\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsxDEV(Paper, {\n          className: UploadPaperHeight,\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            component: \"h2\",\n            variant: \"h6\",\n            gutterBottom: true,\n            style: {\n              color: \"white\",\n              fontSize: 20\n            },\n            children: \"Start upload your music!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            className: classes.inputForm,\n            noValidate: true,\n            autoComplete: \"off\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(TextField, {\n                id: \"name-textfield\",\n                label: \"Name\",\n                placeholder: \"Type song's name...\",\n                value: songname,\n                multiline: true,\n                variant: \"outlined\",\n                size: \"small\",\n                onChange: event => {\n                  setSongName(event.target.value);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 286,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(TextField, {\n                id: \"artist-textfield\",\n                label: \"Artist\",\n                placeholder: \"Type song's artist...\",\n                value: songartist,\n                multiline: true,\n                variant: \"outlined\",\n                size: \"small\",\n                onChange: event => {\n                  setSongArtist(event.target.value);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 298,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              accept: \"audio/*\",\n              id: \"contained-button-file\",\n              className: classes.uploadinput,\n              type: \"file\",\n              onChange: event => {\n                setSongData({\n                  selectedFile: event.target.files[0]\n                });\n                setFileTextField(event.target.files[0].name);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"contained-button-file\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                component: \"span\",\n                className: classes.selectbutton,\n                children: \"Select File\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 325,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              className: classes.fileinput,\n              id: \"file-textfield\",\n              label: \"File Name\",\n              multiline: true,\n              value: fileTextField,\n              InputProps: {\n                readOnly: true\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              className: classes.uploadbutton,\n              variant: \"contained\",\n              startIcon: /*#__PURE__*/_jsxDEV(CloudUploadIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 348,\n                columnNumber: 28\n              }, this),\n              onClick: () => {\n                handleUploads();\n              },\n              children: \"Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: classes.backendInfoDisplay,\n            children: backendInfo.length ? backendInfo.map((b, ind) => {\n              if (b.status === \"matching\") {\n                let p = b.payload.current_idx / b.payload.total_len * 100;\n                console.log(b.payload);\n                return /*#__PURE__*/_jsxDEV(Alert, {\n                  severity: \"info\",\n                  children: [\"matching\", ` ${Math.round(p)}%`]\n                }, ind, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 25\n                }, this);\n              } else {\n                return /*#__PURE__*/_jsxDEV(Alert, {\n                  severity: b.status === \"music_exist\" ? \"warning\" : \"success\",\n                  children: b.status\n                }, ind, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 371,\n                  columnNumber: 25\n                }, this);\n              }\n            }) : null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 13\n          }, this), backendInfo.length ? /*#__PURE__*/_jsxDEV(MatchingResultList, {\n            rows: matchresults\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 15\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 262,\n    columnNumber: 5\n  }, this);\n};\n\n_s(UploadPage, \"UXOEvcWkbZx3vZKvfqHDOPi60/Y=\", false, function () {\n  return [useStyles];\n});\n\n_c = UploadPage;\nexport default UploadPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"UploadPage\");","map":{"version":3,"sources":["/home/fergussojr/Documents/UGM/BlockChain/Demo/finalproject/MusicChain/react/src/UploadPage.js"],"names":["React","useState","useEffect","uploadAudioIPFS","clsx","makeStyles","Container","Grid","Paper","Typography","TextField","Button","Snackbar","CircularProgress","Alert","LinearProgress","Box","CloudUploadIcon","MatchingResultList","useStyles","theme","container","paddingTop","spacing","paddingLeft","paddingRight","paddingBottom","backgroundColor","paper","padding","display","overflow","flexDirection","fixedHeight","height","uploadBoxFixedHeight","backendInfoDisplay","margin","marginLeft","marginRight","inputForm","width","uploadinput","selectbutton","fileinput","uploadbutton","position","UploadPage","props","classes","UploadPaperHeight","web3","accounts","contract","setPage","callAlert","songname","setSongName","songartist","setSongArtist","songdata","setSongData","selectedFile","songHash","setSongHash","fileTextField","setFileTextField","fingerprstatus","setFingerprstatus","backendInfo","setBackendInfo","matchingProgress","setMatchingProgress","matchresults","setMatchResults","pendingMsg","setPendingMsg","uploadPending","setUploadPending","showResult","data","sort","x","y","Number","dist","console","log","i","length","result_from_chain","getMusicByHash","song_hash","name","artist","coverFrom","ipfs_hash","uploader","uploadTime","h","result","methods","call","from","getMusicExists","musicExists","uploadMusicBlockchain","retHash","coverFromHash","music","uploadMusic","send","error","handleUploads","size","source","EventSource","withCredentials","addEventListener","message","msg_obj","JSON","parse","status","close","payload","color","fontSize","event","target","value","files","readOnly","map","b","ind","p","current_idx","total_len","Math","round"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { uploadAudioIPFS } from \"./ipfs/upload\";\nimport clsx from \"clsx\";\n\nimport {\n  makeStyles,\n  Container,\n  Grid,\n  Paper,\n  Typography,\n  TextField,\n  Button,\n  Snackbar,\n  CircularProgress,\n} from \"@material-ui/core\";\n\nimport Alert from \"@material-ui/lab/Alert\";\nimport LinearProgress from \"@material-ui/core/LinearProgress\";\nimport Box from \"@material-ui/core/Box\";\n// import {} from '@material-ui/lab/Alert';\n\nimport CloudUploadIcon from \"@material-ui/icons/CloudUpload\";\n\nimport MatchingResultList from \"./components/MatchingResultList\";\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    paddingTop: theme.spacing(5),\n    paddingLeft: theme.spacing(5),\n    paddingRight: theme.spacing(5),\n    paddingBottom: theme.spacing(5),\n    backgroundColor: \"#202020\",\n  },\n  paper: {\n    padding: theme.spacing(2),\n    display: \"flex\",\n    overflow: \"auto\",\n    flexDirection: \"column\",\n    backgroundColor: \"#808080\",\n  },\n  fixedHeight: {\n    height: 240,\n  },\n  // Upload Box style\n  uploadBoxFixedHeight: {\n    // height: 420,\n  },\n  backendInfoDisplay: {\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4),\n    // width: '36ch',\n  },\n  inputForm: {\n    \"& .MuiTextField-root\": {\n      margin: theme.spacing(2),\n      marginLeft: theme.spacing(4),\n      marginRight: theme.spacing(4),\n      width: \"36ch\",\n    },\n  },\n  uploadinput: {\n    display: \"none\",\n  },\n  selectbutton: {\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4),\n  },\n  fileinput: {\n    margin: theme.spacing(1),\n    marginLeft: theme.spacing(4),\n    width: \"56ch\",\n  },\n  uploadbutton: {\n    position: \"relative\",\n    backgroundColor: \"#39a9cb\",\n    margin: theme.spacing(2),\n    marginLeft: theme.spacing(4),\n    marginRight: theme.spacing(4),\n    height: \"5ch\",\n  },\n}));\n\nconst UploadPage = (props) => {\n  const classes = useStyles();\n  const UploadPaperHeight = clsx(classes.paper, classes.uploadBoxFixedHeight);\n\n  // from props\n  const web3 = props.web3;\n  const accounts = props.accounts;\n  const contract = props.contract;\n  const setPage = props.setPage;\n  // for alert msg\n  const callAlert = props.callAlert;\n  useEffect(() => {\n    setPage(\"Upload\");\n  }, []);\n\n  // states\n  const [songname, setSongName] = useState(\"\");\n  const [songartist, setSongArtist] = useState(\"\");\n  const [songdata, setSongData] = useState({ selectedFile: null });\n  const [songHash, setSongHash] = useState(\"\");\n  const [fileTextField, setFileTextField] = useState(\n    \"you haven't select a file yet...\"\n  );\n  const [fingerprstatus, setFingerprstatus] = useState(\"no file yet\");\n  const [backendInfo, setBackendInfo] = useState([]);\n  const [matchingProgress, setMatchingProgress] = useState({});\n\n  // // for alert msg\n  // const [alertmsg, setAlermsg] = useState('');\n  // const [openAlert, setOpenAlert] = useState(false);\n  // const handleCloseAlertMsg = (event, reason) => {\n  //   if (reason === 'clickaway') {\n  //     return;\n  //   }\n  //   setOpenAlert(false);\n  // };\n  // const callAlert = (msg) => {\n  //   setAlermsg(msg);\n  //   setOpenAlert(true);\n  // };\n\n  // for HPCP matching progress UI\n  const [matchresults, setMatchResults] = useState([\n    // {\n    //   \"name\": \"song1\",\n    //   \"artist\": \"artist1\",\n    //   \"ipfs_hash\": \"hash ipfs\",\n    //   \"uploader\": \"user1\",\n    //   \"dist\": \"cover_dist1\",\n    //   \"exact\" : false\n    // }\n  ]);\n  const [pendingMsg, setPendingMsg] = useState(\"\");\n  const [uploadPending, setUploadPending] = useState(false);\n  const showResult = async (data) => {\n    data.sort((x, y) => Number(x.dist) - Number(y.dist));\n    console.log(data);\n    for (let i = 0; i < data.length; i++) {\n      const result_from_chain = await getMusicByHash(data[i].song_hash);\n      data[i].name = result_from_chain.name;\n      data[i].artist = result_from_chain.artist;\n      data[i].coverFrom = result_from_chain.coverFrom;\n      data[i].name = result_from_chain.name;\n      data[i].ipfs_hash = data[i].song_hash;\n      data[i].uploader = result_from_chain.uploader;\n      data[i].uploadTime = result_from_chain.uploadTime;\n    }\n    console.log(data);\n    setMatchResults(data);\n  };\n\n  const getMusicByHash = async (h) => {\n    const result = await contract.methods\n      .getMusicByHash(h)\n      .call({ from: accounts[0] });\n    return result;\n  };\n\n  const getMusicExists = async () => {\n    const result = await contract.methods\n      .musicExists(songname, songartist)\n      .call({ from: accounts[0] });\n    return result;\n  };\n\n  const uploadMusicBlockchain = async (retHash, coverFromHash = \"None\") => {\n    try {\n      const music = await contract.methods\n        .uploadMusic(retHash, songname, songartist, coverFromHash)\n        .send({ from: accounts[0] });\n\n      console.log(music);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleUploads = async () => {\n    // console.log(`web3: ${web3}`);\n    // console.log(`accounts: ${accounts}`);\n    // console.log(`contract: ${contract}`);\n    // Force user to fill these input field\n    if (!songname) {\n      callAlert(\"You have to set the SONG name!\");\n      return;\n    }\n    if (!songartist) {\n      callAlert(\"You have to set the ARTIST name!\");\n      return;\n    }\n    if (!songdata.selectedFile) {\n      callAlert(\"You have to upload a file!\");\n      return;\n    }\n\n    if (songdata.selectedFile.size >= 100000000) {\n      callAlert(\"The file limit is 100 MB!\");\n      setSongData({ selectedFile: null });\n      return;\n    }\n\n    let musicExists = await getMusicExists();\n    if (musicExists) {\n      callAlert(\"The music had already existed!\");\n      return;\n    }\n\n    setUploadPending(true);\n    uploadAudioIPFS(songdata.selectedFile, songname, (retHash) => {\n      setSongHash(retHash);\n      const source = new EventSource(\n        `http://localhost:3001/processupload?h=${retHash}`,\n        { withCredentials: true }\n      );\n      source.addEventListener(\"message\", (message) => {\n        // let mydata = JSON.stringify(JSON.parse(message.data))\n        console.log(\"Got\", message.data);\n        let msg_obj = JSON.parse(message.data);\n        // setBackendInfo(backendInfo.concat([JSON.parse(JSON.stringify(msg_obj))]))\n        // setBackendInfo(backendInfo.push(msg_obj))\n        // setBackendInfo(backendInfo.concat(JSON.parse(JSON.stringify(msg_obj))));\n        setBackendInfo([...backendInfo, msg_obj]);\n\n        if (msg_obj.status === \"saved_query_hpcp\") {\n          source.close();\n          setUploadPending(false);\n          if (msg_obj.payload.length > 0) {\n            console.log(\"coverfrom\" + msg_obj.payload[0]);\n            uploadMusicBlockchain(retHash, msg_obj.payload[0]);\n          } else {\n            uploadMusicBlockchain(retHash);\n          }\n        } else if (msg_obj.status === \"matching_results\") {\n          // let x = { \"status\": \"matching_results\", \"payload\": [{ \"song_hash\": \"QmRhPHUnNHUodTJb5QciUj6zuEHZZd5fFVTBoJnUTwKh9N\", \"dist\": 0.22824497520923615, \"exact\": false }, { \"song_hash\": \"QmY3vX8TRHvM8RsgJCjHP4FVRNq1CgC6poTPUBxEHRRhkw\", \"dist\": 0.15082646906375885, \"exact\": false }] }\n          showResult(msg_obj.payload);\n        } else if (msg_obj.status === \"matching\") {\n          setMatchingProgress(msg_obj.payload);\n        } else if (msg_obj.status === \"music_exist\") {\n          source.close();\n          setUploadPending(false);\n          callAlert(\"This music is uploaded before\");\n        } else {\n          // setFingerprstatus(message.data);\n        }\n        console.log(\"backendInfo\", backendInfo);\n      });\n\n      // uplaodMusicBlockchain(retHash);\n    });\n\n    // reset input data\n    setSongName(\"\");\n    setSongArtist(\"\");\n    setFileTextField(\"you haven't select a file yet...\");\n  };\n\n  return (\n    <Container maxWidth=\"lg\" className={classes.container}>\n      {/* <Snackbar\n        open={openAlert}\n        autoHideDuration={6000}\n        onClose={handleCloseAlertMsg}\n      >\n        <Alert onClose={handleCloseAlertMsg} severity='error'>\n          {alertmsg}\n        </Alert>\n      </Snackbar> */}\n      <Grid container spacing={6}>\n        <Grid item xs={12}>\n          <Paper className={UploadPaperHeight}>\n            <Typography\n              component=\"h2\"\n              variant=\"h6\"\n              gutterBottom\n              style={{ color: \"white\", fontSize: 20 }}\n            >\n              Start upload your music!\n            </Typography>\n\n            <form className={classes.inputForm} noValidate autoComplete=\"off\">\n              <div>\n                <TextField\n                  id=\"name-textfield\"\n                  label=\"Name\"\n                  placeholder=\"Type song's name...\"\n                  value={songname}\n                  multiline\n                  variant=\"outlined\"\n                  size=\"small\"\n                  onChange={(event) => {\n                    setSongName(event.target.value);\n                  }}\n                />\n                <TextField\n                  id=\"artist-textfield\"\n                  label=\"Artist\"\n                  placeholder=\"Type song's artist...\"\n                  value={songartist}\n                  multiline\n                  variant=\"outlined\"\n                  size=\"small\"\n                  onChange={(event) => {\n                    setSongArtist(event.target.value);\n                  }}\n                />\n              </div>\n            </form>\n\n            <div>\n              <input\n                accept=\"audio/*\"\n                id=\"contained-button-file\"\n                className={classes.uploadinput}\n                type=\"file\"\n                onChange={(event) => {\n                  setSongData({ selectedFile: event.target.files[0] });\n                  setFileTextField(event.target.files[0].name);\n                }}\n              />\n              <label htmlFor=\"contained-button-file\">\n                <Button\n                  variant=\"contained\"\n                  component=\"span\"\n                  className={classes.selectbutton}\n                >\n                  Select File\n                </Button>\n              </label>\n\n              <TextField\n                className={classes.fileinput}\n                id=\"file-textfield\"\n                label=\"File Name\"\n                multiline\n                value={fileTextField}\n                InputProps={{\n                  readOnly: true,\n                }}\n              />\n\n              <Button\n                className={classes.uploadbutton}\n                variant=\"contained\"\n                startIcon={<CloudUploadIcon />}\n                onClick={() => {\n                  handleUploads();\n                }}\n              >\n                Upload\n              </Button>\n            </div>\n            <div className={classes.backendInfoDisplay}>\n              {/* {uploadPending && <CircularProgress />} */}\n              {backendInfo.length\n                ? backendInfo.map((b, ind) => {\n                    if (b.status === \"matching\") {\n                      let p =\n                        (b.payload.current_idx / b.payload.total_len) * 100;\n                      console.log(b.payload);\n                      return (\n                        <Alert key={ind} severity=\"info\">\n                          matching{` ${Math.round(p)}%`}\n                        </Alert>\n                      );\n                    } else {\n                      return (\n                        <Alert\n                          key={ind}\n                          severity={\n                            b.status === \"music_exist\" ? \"warning\" : \"success\"\n                          }\n                        >\n                          {b.status}\n                        </Alert>\n                      );\n                    }\n                  })\n                : null}\n            </div>\n\n            {backendInfo.length ? (\n              <MatchingResultList rows={matchresults} />\n            ) : null}\n          </Paper>\n        </Grid>\n      </Grid>\n    </Container>\n  );\n};\n\nexport default UploadPage;\n"]},"metadata":{},"sourceType":"module"}